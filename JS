const anoSemestreInicioSelect = document.getElementById('anoSemestreInicio');
const qtdSemestreInput = document.getElementById('qtdSemestre');
const qtdTrancamentosInput = document.getElementById('qtdTrancamentos');
const resultadoIntegralizacaoSpan = document.getElementById('resultadoIntegralizacao');

function preencherAnoSemestreInicio() {
    // Limpa as opções existentes antes de preencher
    anoSemestreInicioSelect.innerHTML = ''; 

    const startYear = 2003; // Novo ano de início
    const currentYear = new Date().getFullYear();
    const endYear = currentYear + 10; // Mantém 10 anos à frente do ano atual

    for (let year = startYear; year <= endYear; year++) {
        const option1 = document.createElement('option');
        option1.value = `${year}-01`;
        option1.textContent = `${year}-01`;
        anoSemestreInicioSelect.appendChild(option1);

        const option2 = document.createElement('option');
        option2.value = `${year}-02`;
        option2.textContent = `${year}-02`;
        anoSemestreInicioSelect.appendChild(option2);
    }
    // Seleciona 2024-01 por padrão se existir, ou o último ano se for mais antigo
    anoSemestreInicioSelect.value = "2024-01";
    // Se "2024-01" não for uma opção válida (e.g., para testar anos anteriores),
    // você pode ajustar isso para selecionar o último ano ou o primeiro ano na lista
    // por exemplo: anoSemestreInicioSelect.value = `${currentYear}-01`;
}

function calcularIntegralizacao() {
    const inicio = anoSemestreInicioSelect.value.split('-');
    let anoInicio = parseInt(inicio[0]);
    let semestreInicio = parseInt(inicio[1]);
    const qtdSemestre = parseInt(qtdSemestreInput.value);
    const qtdTrancamentos = parseInt(qtdTrancamentosInput.value);

    if (isNaN(anoInicio) || isNaN(semestreInicio) || isNaN(qtdSemestre) || isNaN(qtdTrancamentos)) {
        resultadoIntegralizacaoSpan.textContent = "Erro no cálculo";
        return;
    }

    // A lógica para integralização que resulta em 2027-02 para 2024-01 e 5 semestres.
    // Isso sugere que a integralização é (QTD_SEMESTRE * 1.4) + QTD_TRANCAMENTOS em termos de semestres a adicionar.
    let totalSemestresParaAdicionar = Math.round(qtdSemestre * 1.4) + qtdTrancamentos;


    let anoFinal = anoInicio;
    let semestreFinal = semestreInicio;

    for (let i = 0; i < totalSemestresParaAdicionar; i++) {
        semestreFinal++;
        if (semestreFinal > 2) {
            semestreFinal = 1; // Volta para o semestre 01
            anoFinal++; // Avança um ano
        }
    }

    resultadoIntegralizacaoSpan.textContent = `${anoFinal}-${semestreFinal.toString().padStart(2, '0')}`;
}

function resetCalculadora() {
    // Reseta os valores dos campos para o padrão
    anoSemestreInicioSelect.value = "2024-01";
    qtdSemestreInput.value = "5";
    qtdTrancamentosInput.value = "0";
    
    // Recalcula para mostrar o resultado com os valores padrão
    calcularIntegralizacao();
}

// Event Listeners para atualizar o cálculo ao mudar os valores
anoSemestreInicioSelect.addEventListener('change', calcularIntegralizacao);
qtdSemestreInput.addEventListener('change', calcularIntegralizacao);
qtdTrancamentosInput.addEventListener('change', calcularIntegralizacao);


// Inicializa a calculadora ao carregar a página
document.addEventListener('DOMContentLoaded', () => {
    preencherAnoSemestreInicio();
    calcularIntegralizacao(); // Calcula a integralização inicial
});
